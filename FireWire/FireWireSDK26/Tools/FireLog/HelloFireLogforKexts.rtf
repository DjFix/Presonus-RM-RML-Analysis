{\rtf1\ansi\ansicpg1252\cocoartf949
{\fonttbl\f0\froman\fcharset0 Times-Roman;\f1\fnil\fcharset0 LucidaGrande;\f2\fswiss\fcharset0 Helvetica;
\f3\fmodern\fcharset0 Courier;\f4\fnil\fcharset0 Monaco;}
{\colortbl;\red255\green255\blue255;\red104\green56\blue33;\red118\green15\blue80;\red137\green19\blue21;
\red35\green110\blue37;}
\margl1440\margr1440\vieww14540\viewh11960\viewkind0
\pard\tx560\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\ql\qnatural

\f0\b\fs36 \cf0 \ul \ulc0 \
\pard\tx960\tx1920\tx2880\tx3840\tx4800\tx5760\tx6720\tx7680\tx8640\tx9600\li1120\fi-400\ri860\ql\qnatural

\f1 \cf0 \ulnone "Hello, FireLog" for Kexts - adding FireLog to a kext
\fs48 \
\pard\tx560\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\ql\qnatural

\f0\b0\fs24 \cf0 \
\pard\tx1100\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li1080\ri-2220\ql\qnatural

\f1 \cf0 Note: These instructions are for using FireLog from kernel space. Tutorial HelloFireLogforUserSpace describes how to use FireLog in a kernel extension. \
\
1. Installing the Firelog package on your target machine.  (This step is the same\
for user space or kernel extensions.)\
\

\f2 		Copy from the package from the latest installed SDK:\
/Developer/FireWireSDKnn/Tools/FireLog/FireLog 2.0.0.pkg\
	\
Install the package on the target machine. \
\
If the installer fails for any reason, or if the installer warns that you are installing over a newer version,  delete the old FireLog.pkg receipt in the directory /Library/Receipts and start the install over again. \
\
When the package has been installed, reboot your machine .\
\
\
2. Copying the FireLog app to your "observer machine". 
\f1  (This step is the same\
for user space or kernel extensions.)\

\f2 \
Copy from the latest installed SDK:\
	/Developer/FireWireSDKnn/Tools/FireLog/FireLog\
\
  You will run the app later. \
\
3. Finding a kext to use.\
    \
If you want an example kext to use,  first do the HelloIOKit tutorial to create the HelloIOKit.kext\
	\
Open XCode\
Select "Documentation" from the XCode Help menu.\
In the search field type "HelloIOKit".\
The tutorial is called "Hello I/O Kit:Creating a Device Driver With Xcode.\
Follow the tutorial and create a working kext and associated XCode project with all the relevant files described in the tutorial.\
\
4. Adding FireLog to your kext.\
\
	Add <IOKit/firewire/FireLog.h> to your source file\
\
Note: if <IOKit/firewire/FireLog.h> can not be found when you compile, you can use \
<IOKit/firewire/IOFireLog.h> instead.\
\
	Add calls to FireLog() with printf style formatting and arguments\
\
For example, adding a "Hello, Firelog" message to the init function of HelloIOKit, would look like this:
\f3  \
\pard\tx1100\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li1100\fi-20\ri-2220\ql\qnatural\pardirnatural

\f4\fs20 \cf0 \CocoaLigature0 \
\cf2 			#include <IOKit/IOLib.h>\cf0 \
\cf2 			#include "HelloIOKit.h"\cf0 \
\
			#include <IOKit/firewire/FireLog.h>\
\
\pard\tx1100\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li1100\fi-20\ri-2220\ql\qnatural\pardirnatural
\cf3 			extern\cf0  \cf4 "C"\cf0  \{\
\pard\tx1100\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li1100\fi-20\ri-2220\ql\qnatural\pardirnatural
\cf2 			#include <pexpert/pexpert.h>//This is for debugging purposes ONLY\cf0 \
			\}\
\pard\tx1100\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li1100\fi-20\ri-2220\ql\qnatural\pardirnatural
\cf5 			// Define my superclass\cf0 \
\pard\tx1100\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li1100\fi-20\ri-2220\ql\qnatural\pardirnatural
\cf2 			#define super IOService\cf0 \
\pard\tx1100\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li1100\fi-20\ri-2220\ql\qnatural\pardirnatural
\cf5 			// REQUIRED! This macro defines the class's constructors, destructors,\cf0 \
\cf5 			// and several other methods I/O Kit requires. Do NOT use super as the\cf0 \
\cf5 			// second parameter. You must use the literal name of the superclass.\cf0 \
			OSDefineMetaClassAndStructors(com_mytutorial_driver_HelloIOKit, IOService)\
\pard\tx1100\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li1100\fi-20\ri-2220\ql\qnatural\pardirnatural
\cf3 			bool\cf0  com_mytutorial_driver_HelloIOKit::init(OSDictionary *dict)\
			\{\
   		\cf3 bool\cf0  res = super::init(dict);\
    		IOLog(\cf4 "Initializing\\n"\cf0 );\
				FireLog(\cf4 "Hello, FireLog\\n"\cf0 );\
    		\cf3 return\cf0  res;\
			\}\
\pard\tx1100\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li1080\ri-2220\ql\qnatural\pardirnatural
\cf0 \

\f2\fs24 5.	Edit the build settings\
\
\pard\tx1100\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li1080\ri-2220\sa240\ql\qnatural
\cf0 \CocoaLigature1 If you followed the HelloIOKit tutorial, you have configured XCode  so you can edit your driver\'92s Info.plist file using Property List Editor:\
Select HelloIOKit in the Groups & Files view. Double-click Info.plist in the Xcode project window. XCode starts Property List Editor, which displays the Info.plist file. (If Property List Editor displays a second editing window named Untitled, dismiss it by clicking the red close button in the upper left.)\
In Property List Editor, click the disclosure triangle next to Root. You should see the elements of the property list file. \
Click on the line for OSBundleLibraries and click the disclosure triangle at the beginning of the line. The button previously labeled New Sibling should change to New Child. If not, check to be sure the disclosure triangle next to OSBundleLibraries is pointing down.\
Click the button that now says New Child (as soon as you do, it will change back to New Sibling). A new item will appear below com.apple.kernel.mach. Change the name from New item to com.apple.FireLog (make sure the L is capitalized.)\
Leave the Class set to String and double-click on the Value field and enter 2.0\
\pard\tx1100\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li1080\ri-2220\ql\qnatural
\cf0 Click File > Save in the Property List Editor menu to save your changes. Then choose Property List Editor > Quit Property List Editor to return to your project in Xcode\
\
Rebuild your kext again with the new build settings. \
\pard\tx1100\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li1080\ri-2220\ql\qnatural\pardirnatural
\cf0 \
6. Starting up FireLog application on the observer machine. 
\f1 (This step is the same\
\pard\tx1100\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li1080\ri-2220\ql\qnatural
\cf0 for user space or kernel extensions.)
\f2 \
\pard\tx1100\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li1080\ri-2220\ql\qnatural\pardirnatural
\cf0 \
Connect the machines with a FireWire Cable\
Double click on the FireLog application to start it up\
In the FWDevices window, highlight the device shown \
(It will say something like "IOFireWireUnit <0x393>") , and press select\
\
You will get a window for your device. \
Press the RESUME button to allow it to receive log messages.\
\
7.  Unloading the old version of HelloIOKit.kext.\
\
If the old HelloIOKit.kext is still loaded you must unload it.\
Open a terminal window\
You can check if the old version of the kext is still loaded, type:\
			% 
\f4\fs22 kextstat | grep HelloIOKit
\f2\fs24 \
To unload the old version of HelloIOKit, type:\
			% 
\f4\fs22 sudo kextunload HelloIOKit.kext
\f2 \

\fs24 \
8. Removing the old version of the HelloIOKit.kext - do this even if it was not loaded.\
\
From the terminal type (assuming that the kext is in /tmp as the HelloIOkit tutorial instructed):\
			% 
\f4\fs22 sudo rm -r /tmp/HelloIOKit.kext
\f2\fs24 \
\
9. Loading and running.\
\
Load and run your new driver the same way as described in the HelloIOKit tutorial.\
\
From a terminal window,\

\f1 Use the 
\b cd
\b0  command to move to the appropriate directory. For example:\
\pard\tx1100\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li1080\ri-2220\ql\qnatural
\cf0 			
\f4\fs22 % cd Projects/HelloIOKit/build
\f2\fs24 \
\pard\tx1100\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li1080\ri-2220\ql\qnatural\pardirnatural
\cf0 \
\pard\tx1100\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li1080\ri-2220\ql\qnatural

\f1 \cf0 to copy your driver to 
\f4\fs22 /tmp
\f1\fs24 :\
			
\f4\fs22 % sudo cp -R HelloIOKit.kext /tmp
\f1\fs24 \
\
	Check the ownership and permissions of your driver by moving to the 
\f4\fs22 /tmp
\f1\fs24  directory and using the 
\b ls -l
\b0  command:\
\pard\tx1100\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li1080\ri-2220\ql\qnatural

\f4\fs22 \cf0 			% cd /tmp\
			% ls -l\
			drwxr-xr-x 3 root wheel 102 Jun 19 10:30 HelloIOKit.kext\
\
\pard\tx1100\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li1080\ri-2220\ql\qnatural

\f1\fs24 \cf0 From the 
\f4\fs22 /tmp
\f1\fs24  directory, use the 
\b kextload
\b0  command with the 
\b sudo
\b0  command; this loads your driver with the FireLog message\
\
\pard\tx1100\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li1080\ri-2220\ql\qnatural

\f4\fs22 \cf0 			% sudo kextload -v HelloIOKit.kext\
\
\pard\tx1100\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li1080\ri-2220\ql\qnatural

\f2\fs24 \cf0 10. Your "Hello, FireLog" message will show up in the FireLog window on the observer machine!\
}